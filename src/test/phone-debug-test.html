<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phone Number Format Debug Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-case {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .pass {
            background-color: #d4edda;
            border-color: #c3e6cb;
        }
        .fail {
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }
        .code {
            font-family: monospace;
            background-color: #f8f9fa;
            padding: 5px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <h1>Phone Number Format Debug Test</h1>
    <p>This page tests the phone number formatting function that should format phone numbers as "(+countrycode) phonenumber"</p>
    
    <div id="test-results"></div>
    
    <script>
        // Copy of the formatPhoneNumber function from utils.ts
        function formatPhoneNumber(countryCode, phoneNumber) {
            // Clean up the country code - ensure it starts with +
            let cleanCountryCode = countryCode.trim();
            if (!cleanCountryCode.startsWith('+')) {
                cleanCountryCode = `+${cleanCountryCode}`;
            }
            
            // Clean up the phone number - remove any special characters except digits
            const cleanPhoneNumber = phoneNumber.trim();
            
            // Return in the required format "(+countrycode) phonenumber"
            return `(${cleanCountryCode}) ${cleanPhoneNumber}`;
        }
        
        // Test cases
        const testCases = [
            {
                input: { countryCode: '+351', phoneNumber: '8072624362' },
                expected: '(+351) 8072624362',
                description: 'Standard case with + prefix'
            },
            {
                input: { countryCode: '351', phoneNumber: '8072624362' },
                expected: '(+351) 8072624362',
                description: 'Country code without + prefix'
            },
            {
                input: { countryCode: '+351', phoneNumber: '80726243620' },
                expected: '(+351) 80726243620',
                description: 'Case with longer phone number (as mentioned in feedback)'
            }
        ];
        
        // Run tests and display results
        const resultsDiv = document.getElementById('test-results');
        let passedTests = 0;
        
        testCases.forEach((testCase, index) => {
            const result = formatPhoneNumber(testCase.input.countryCode, testCase.input.phoneNumber);
            const passed = result === testCase.expected;
            
            if (passed) passedTests++;
            
            const testDiv = document.createElement('div');
            testDiv.className = `test-case ${passed ? 'pass' : 'fail'}`;
            
            testDiv.innerHTML = `
                <h3>Test ${index + 1}: ${testCase.description}</h3>
                <p><strong>Input:</strong></p>
                <ul>
                    <li>Country Code: <span class="code">${testCase.input.countryCode}</span></li>
                    <li>Phone Number: <span class="code">${testCase.input.phoneNumber}</span></li>
                </ul>
                <p><strong>Expected:</strong> <span class="code">${testCase.expected}</span></p>
                <p><strong>Actual:</strong> <span class="code">${result}</span></p>
                <p><strong>Status:</strong> ${passed ? '‚úÖ PASSED' : '‚ùå FAILED'}</p>
            `;
            
            resultsDiv.appendChild(testDiv);
        });
        
        // Summary
        const summaryDiv = document.createElement('div');
        summaryDiv.innerHTML = `
            <h2>Summary</h2>
            <p>${passedTests}/${testCases.length} tests passed</p>
            <p>${passedTests === testCases.length ? 'üéâ All tests passed!' : '‚ö†Ô∏è Some tests failed.'}</p>
        `;
        resultsDiv.appendChild(summaryDiv);
        
        // Test what would be sent in the webhook payload
        console.log('=== Webhook Payload Test ===');
        const profileData = {
            phoneCountryCode: '+351',
            phoneNumber: '80726243620'
        };
        
        const combinedPhone = formatPhoneNumber(profileData.phoneCountryCode, profileData.phoneNumber);
        const updatePayload = {
            agent_id: 'test-agent-id',
            agent_name: 'Test Agent',
            agent_email: 'test@example.com',
            agent_phone: combinedPhone,
            agent_language: 'English',
            agent_image_url: '',
            login_username: 'testuser',
            sheet_url: ''
        };
        
        console.log('Profile data:', profileData);
        console.log('Combined phone:', combinedPhone);
        console.log('Full webhook payload:', JSON.stringify(updatePayload, null, 2));
    </script>
</body>
</html>